<!DOCTYPE html>
<html lang="fr" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NetWatch — {% block title %}{% endblock %}</title>
<link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Rajdhani:wght@300;400;600;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
<style>
/* ── Dark Theme (default) ─────────────────────────────────────── */
[data-theme="dark"] {
  --bg:       #040810;
  --surface:  #080f1a;
  --surface2: #0c1624;
  --border:   #0d2137;
  --border2:  #1a3a52;
  --accent:   #00d4ff;
  --accent2:  #00ff88;
  --danger:   #ff3366;
  --warn:     #ffaa00;
  --text:     #c8e6f5;
  --muted:    #4a7a96;
  --logo-glow: rgba(0,212,255,0.3);
  --grid-line: rgba(0,212,255,0.03);
  --scan-line: rgba(0,212,255,0.4);
}

/* ── Light Theme ──────────────────────────────────────────────── */
[data-theme="light"] {
  --bg:       #f0f4f8;
  --surface:  #ffffff;
  --surface2: #e8eef5;
  --border:   #d0dce8;
  --border2:  #b0c4d8;
  --accent:   #0088bb;
  --accent2:  #00aa55;
  --danger:   #dd2255;
  --warn:     #cc8800;
  --text:     #1a2a3a;
  --muted:    #607080;
  --logo-glow: rgba(0,136,187,0.2);
  --grid-line: rgba(0,136,187,0.04);
  --scan-line: rgba(0,136,187,0.15);
}

* { margin:0; padding:0; box-sizing:border-box; }
body {
  background: var(--bg);
  color: var(--text);
  font-family: 'Rajdhani', sans-serif;
  min-height: 100vh;
  display: flex;
  transition: background 0.3s, color 0.3s;
}
[data-theme="dark"] body::before {
  content:'';
  position:fixed; inset:0;
  background-image:
    linear-gradient(var(--grid-line) 1px, transparent 1px),
    linear-gradient(90deg, var(--grid-line) 1px, transparent 1px);
  background-size: 40px 40px;
  pointer-events:none;
  z-index:0;
}

/* ── Sidebar ─────────────────────────────────────────────────── */
.sidebar {
  width: 240px;
  background: var(--surface);
  border-right: 1px solid var(--border);
  display: flex; flex-direction: column;
  position: fixed; top:0; left:0; bottom:0;
  z-index: 100;
  transition: background 0.3s;
}
.sidebar-logo {
  padding: 24px 20px;
  border-bottom: 1px solid var(--border);
  display: flex; align-items: center; gap: 12px;
}
.sidebar-logo-icon {
  width:36px; height:36px;
  background: rgba(0,212,255,0.1);
  border: 1px solid var(--accent);
  border-radius: 50%;
  display:flex; align-items:center; justify-content:center;
  flex-shrink:0;
  box-shadow: 0 0 12px var(--logo-glow);
}
.sidebar-logo-icon svg { width:18px; height:18px; color:var(--accent); }
.sidebar-logo h2 {
  font-family:'Share Tech Mono',monospace;
  font-size:1.1rem; color:var(--accent); letter-spacing:3px;
}
.sidebar-logo small {
  display:block; font-size:0.6rem;
  color:var(--muted); letter-spacing:2px; text-transform:uppercase;
}
.nav-section { padding:16px 0; flex:1; overflow-y:auto; }
.nav-label {
  padding:6px 20px; font-size:0.6rem;
  letter-spacing:3px; text-transform:uppercase;
  color:var(--muted); font-family:'Share Tech Mono',monospace;
}
.nav-item {
  display:flex; align-items:center; gap:12px;
  padding:10px 20px; color:var(--muted);
  text-decoration:none; font-size:0.9rem;
  font-weight:600; letter-spacing:1px;
  transition:all 0.2s; position:relative;
}
.nav-item svg { width:18px; height:18px; flex-shrink:0; }
.nav-item:hover { color:var(--text); background:rgba(0,212,255,0.05); }
.nav-item.active { color:var(--accent); background:rgba(0,212,255,0.08); }
.nav-item.active::before {
  content:''; position:absolute; left:0; top:0; bottom:0;
  width:2px; background:var(--accent);
}
.sidebar-bottom {
  padding:16px 20px;
  border-top:1px solid var(--border);
  display:flex; flex-direction:column; gap:10px;
}
.status-indicator {
  display:flex; align-items:center; gap:8px;
  font-size:0.75rem; color:var(--muted);
  font-family:'Share Tech Mono',monospace;
}
.status-dot {
  width:8px; height:8px; border-radius:50%;
  background:var(--muted); flex-shrink:0;
}
.status-dot.active {
  background:var(--accent2);
  box-shadow:0 0 8px var(--accent2);
  animation: blink 1s ease infinite;
}
@keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.4} }

/* ── Theme Toggle ─────────────────────────────────────────────── */
.theme-toggle {
  display:flex; align-items:center; gap:8px;
  cursor:pointer;
  font-size:0.72rem; font-family:'Share Tech Mono',monospace;
  color:var(--muted); user-select:none;
}
.toggle-track {
  width:38px; height:20px;
  background:var(--border2);
  border-radius:10px;
  position:relative;
  transition:background 0.3s;
  flex-shrink:0;
}
.toggle-track.on { background:var(--accent); }
.toggle-thumb {
  position:absolute; top:3px; left:3px;
  width:14px; height:14px;
  background:var(--surface);
  border-radius:50%;
  transition:transform 0.3s;
  box-shadow:0 1px 3px rgba(0,0,0,0.3);
}
.toggle-track.on .toggle-thumb { transform:translateX(18px); }

/* ── Main ─────────────────────────────────────────────────────── */
.main { margin-left:240px; flex:1; display:flex; flex-direction:column; min-height:100vh; position:relative; z-index:1; }
.topbar {
  height:56px;
  background:var(--surface);
  border-bottom:1px solid var(--border);
  display:flex; align-items:center;
  padding:0 24px; gap:16px;
  position:sticky; top:0; z-index:50;
  transition:background 0.3s;
}
.topbar-title { font-size:1.1rem; font-weight:700; letter-spacing:2px; text-transform:uppercase; flex:1; }
.topbar-time { font-family:'Share Tech Mono',monospace; font-size:0.8rem; color:var(--muted); }
.topbar-user { display:flex; align-items:center; gap:8px; font-size:0.8rem; color:var(--muted); }
.topbar-user span { color:var(--accent); }
.btn-logout {
  background:transparent; border:1px solid var(--border2);
  border-radius:3px; padding:6px 12px;
  color:var(--muted); font-family:'Rajdhani',sans-serif;
  font-size:0.8rem; letter-spacing:1px;
  cursor:pointer; text-decoration:none; transition:all 0.2s;
}
.btn-logout:hover { border-color:var(--danger); color:var(--danger); }
.page-content { padding:24px; flex:1; }

/* ── Cards ───────────────────────────────────────────────────── */
.card {
  background:var(--surface); border:1px solid var(--border);
  border-radius:4px; overflow:hidden;
  transition:background 0.3s;
}
.card-header {
  padding:16px 20px; border-bottom:1px solid var(--border);
  display:flex; align-items:center; gap:10px;
}
.card-header h3 {
  font-size:0.85rem; font-weight:700;
  letter-spacing:2px; text-transform:uppercase; flex:1;
}
.card-header svg { width:16px; height:16px; color:var(--accent); }
.card-body { padding:20px; }

/* ── Grid ────────────────────────────────────────────────────── */
.grid { display:grid; gap:16px; }
.grid-4 { grid-template-columns:repeat(4,1fr); }
.grid-3 { grid-template-columns:repeat(3,1fr); }
.grid-2 { grid-template-columns:repeat(2,1fr); }

/* ── Stat Cards ───────────────────────────────────────────────── */
.stat-card {
  background:var(--surface); border:1px solid var(--border);
  border-radius:4px; padding:20px; position:relative; overflow:hidden;
  transition:background 0.3s;
}
.stat-card::after { content:''; position:absolute; top:0; left:0; right:0; height:1px; }
.stat-card.blue::after  { background:linear-gradient(90deg,transparent,var(--accent),transparent); }
.stat-card.green::after { background:linear-gradient(90deg,transparent,var(--accent2),transparent); }
.stat-card.red::after   { background:linear-gradient(90deg,transparent,var(--danger),transparent); }
.stat-card.warn::after  { background:linear-gradient(90deg,transparent,var(--warn),transparent); }
.stat-label { font-size:0.65rem; letter-spacing:2px; text-transform:uppercase; color:var(--muted); font-family:'Share Tech Mono',monospace; margin-bottom:8px; }
.stat-value { font-family:'Share Tech Mono',monospace; font-size:2rem; line-height:1; margin-bottom:4px; }
.stat-value.blue  { color:var(--accent);  }
.stat-value.green { color:var(--accent2); }
.stat-value.red   { color:var(--danger);  }
.stat-value.warn  { color:var(--warn);    }
.stat-sub { font-size:0.75rem; color:var(--muted); }

/* ── Table ────────────────────────────────────────────────────── */
.table-wrap { overflow-x:auto; }
table { width:100%; border-collapse:collapse; font-size:0.85rem; }
thead th {
  padding:10px 12px; text-align:left;
  font-size:0.65rem; letter-spacing:2px; text-transform:uppercase;
  color:var(--muted); font-family:'Share Tech Mono',monospace;
  border-bottom:1px solid var(--border); white-space:nowrap;
}
tbody tr { border-bottom:1px solid var(--border); transition:background 0.15s; }
tbody tr:hover { background:rgba(0,212,255,0.03); }
tbody tr.suspicious { background:rgba(255,51,102,0.05); }
tbody tr.suspicious:hover { background:rgba(255,51,102,0.08); }
tbody td { padding:9px 12px; white-space:nowrap; }

/* ── Badges ──────────────────────────────────────────────────── */
.badge {
  display:inline-flex; align-items:center;
  padding:2px 8px; border-radius:2px;
  font-size:0.7rem; font-family:'Share Tech Mono',monospace;
  letter-spacing:1px; font-weight:600;
}
.badge-tcp   { background:rgba(0,212,255,0.1);  color:var(--accent);  border:1px solid rgba(0,212,255,0.2);  }
.badge-udp   { background:rgba(0,255,136,0.1);  color:var(--accent2); border:1px solid rgba(0,255,136,0.2);  }
.badge-icmp  { background:rgba(255,170,0,0.1);  color:var(--warn);    border:1px solid rgba(255,170,0,0.2);  }
.badge-other { background:rgba(74,122,150,0.1); color:var(--muted);   border:1px solid rgba(74,122,150,0.2); }
.badge-susp  { background:rgba(255,51,102,0.1); color:var(--danger);  border:1px solid rgba(255,51,102,0.3); }
.badge-ok    { background:rgba(0,255,136,0.08); color:var(--accent2); border:1px solid rgba(0,255,136,0.2);  }

/* ── Buttons ─────────────────────────────────────────────────── */
.btn {
  display:inline-flex; align-items:center; gap:8px;
  padding:10px 20px; border-radius:3px;
  font-family:'Rajdhani',sans-serif; font-size:0.85rem;
  font-weight:700; letter-spacing:2px; text-transform:uppercase;
  cursor:pointer; border:1px solid; transition:all 0.2s; text-decoration:none;
}
.btn svg { width:16px; height:16px; }
.btn-primary { background:transparent; border-color:var(--accent);  color:var(--accent);  }
.btn-primary:hover { background:var(--accent);  color:var(--bg); }
.btn-danger  { background:transparent; border-color:var(--danger);  color:var(--danger);  }
.btn-danger:hover  { background:var(--danger);  color:#fff; }
.btn-success { background:transparent; border-color:var(--accent2); color:var(--accent2); }
.btn-success:hover { background:var(--accent2); color:var(--bg); }
.btn-muted   { background:transparent; border-color:var(--border2); color:var(--muted);   }
.btn-muted:hover   { border-color:var(--text); color:var(--text); }
.btn:disabled { opacity:0.4; cursor:not-allowed; pointer-events:none; }

/* ── Filters ─────────────────────────────────────────────────── */
.filter-input, .filter-select {
  background:var(--bg); border:1px solid var(--border2);
  border-radius:3px; padding:8px 12px;
  color:var(--text); font-family:'Share Tech Mono',monospace;
  font-size:0.8rem; outline:none; transition:border-color 0.2s;
}
.filter-input { width:180px; }
.filter-input:focus, .filter-select:focus { border-color:var(--accent); }
.filter-select { cursor:pointer; }

/* ── Misc ────────────────────────────────────────────────────── */
.mb-16 { margin-bottom:16px; }
.mb-24 { margin-bottom:24px; }
.flex { display:flex; }
.gap-12 { gap:12px; }
.gap-16 { gap:16px; }
.items-center { align-items:center; }
.justify-between { justify-content:space-between; }
.text-muted { color:var(--muted); font-size:0.8rem; font-family:'Share Tech Mono',monospace; }
.text-accent  { color:var(--accent);  }
.text-danger  { color:var(--danger);  }
.text-success { color:var(--accent2); }

/* ── Pagination ──────────────────────────────────────────────── */
.pagination { display:flex; gap:6px; align-items:center; }
.page-btn {
  width:32px; height:32px; background:transparent;
  border:1px solid var(--border2); border-radius:3px;
  color:var(--muted); font-family:'Share Tech Mono',monospace;
  font-size:0.75rem; cursor:pointer;
  display:flex; align-items:center; justify-content:center;
  transition:all 0.2s;
}
.page-btn:hover { border-color:var(--accent); color:var(--accent); }
.page-btn.active { border-color:var(--accent); color:var(--accent); background:rgba(0,212,255,0.1); }

/* ── Toast ───────────────────────────────────────────────────── */
.toast-container { position:fixed; bottom:24px; right:24px; z-index:1000; display:flex; flex-direction:column; gap:8px; }
.toast {
  background:var(--surface2); border:1px solid var(--border2);
  border-radius:4px; padding:12px 16px;
  font-size:0.8rem; font-family:'Share Tech Mono',monospace;
  display:flex; align-items:center; gap:10px;
  animation:slideIn 0.3s ease; max-width:300px;
}
.toast.success { border-left:3px solid var(--accent2); }
.toast.error   { border-left:3px solid var(--danger);  }
.toast.info    { border-left:3px solid var(--accent);  }
@keyframes slideIn { from{transform:translateX(20px);opacity:0} to{transform:translateX(0);opacity:1} }

/* ── Scrollbar ───────────────────────────────────────────────── */
::-webkit-scrollbar { width:6px; height:6px; }
::-webkit-scrollbar-track { background:var(--bg); }
::-webkit-scrollbar-thumb { background:var(--border2); border-radius:3px; }
::-webkit-scrollbar-thumb:hover { background:var(--muted); }
</style>
{% block extra_style %}{% endblock %}
</head>
<body>

<!-- Sidebar -->
<nav class="sidebar">
  <div class="sidebar-logo">
    <div class="sidebar-logo-icon">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
        <circle cx="12" cy="12" r="10"/>
        <path d="M12 6v6l4 2"/>
        <circle cx="12" cy="12" r="3" fill="currentColor" opacity="0.4"/>
      </svg>
    </div>
    <div>
      <h2>NetWatch</h2>
      <small>Trafic Réseau</small>
    </div>
  </div>

  <div class="nav-section">
    <div class="nav-label">Navigation</div>
    <a href="/dashboard" class="nav-item {% if request.path=='/dashboard' %}active{% endif %}">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
      Tableau de bord
    </a>
    <a href="/capture" class="nav-item {% if request.path=='/capture' %}active{% endif %}">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M12 1v4M12 19v4M4.22 4.22l2.83 2.83M16.95 16.95l2.83 2.83M1 12h4M19 12h4M4.22 19.78l2.83-2.83M16.95 7.05l2.83-2.83"/></svg>
      Capture Live
    </a>
    <a href="/pcap" class="nav-item {% if request.path=='/pcap' %}active{% endif %}">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="12" y1="18" x2="12" y2="12"/><line x1="9" y1="15" x2="15" y2="15"/></svg>
      Analyser PCAP
    </a>
    <a href="/reports" class="nav-item {% if request.path=='/reports' %}active{% endif %}">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
      Rapports
    </a>

    <div class="nav-label" style="margin-top:8px;">Gestion</div>
    <a href="/register" class="nav-item {% if request.path=='/register' %}active{% endif %}">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/><line x1="19" y1="8" x2="19" y2="14"/><line x1="22" y1="11" x2="16" y2="11"/></svg>
      Créer un compte
    </a>
  </div>

  <div class="sidebar-bottom">
    <!-- Theme Toggle -->
    <div class="theme-toggle" onclick="toggleTheme()">
      <div class="toggle-track" id="toggle-track">
        <div class="toggle-thumb"></div>
      </div>
      <span id="theme-label">Mode sombre</span>
    </div>

    <!-- Status -->
    <div class="status-indicator">
      <div class="status-dot" id="sidebar-status-dot"></div>
      <span id="sidebar-status-text">Inactif</span>
    </div>
  </div>
</nav>

<!-- Main -->
<div class="main">
  <div class="topbar">
    <div class="topbar-title">{% block page_title %}{% endblock %}</div>
    <div class="topbar-time" id="clock"></div>
    <div class="topbar-user">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
      <span>{{ session.username }}</span>
    </div>
    <a href="/logout" class="btn-logout">Déconnexion</a>
  </div>

  <div class="page-content">
    {% block content %}{% endblock %}
  </div>
</div>

<!-- Toast -->
<div class="toast-container" id="toasts"></div>

<script>
// ── Clock ──────────────────────────────────────────────────────
function updateClock() {
  document.getElementById('clock').textContent = new Date().toLocaleTimeString('fr-FR');
}
setInterval(updateClock, 1000); updateClock();

// ── Toast ──────────────────────────────────────────────────────
function showToast(msg, type='info', duration=3000) {
  const c = document.getElementById('toasts');
  const t = document.createElement('div');
  t.className = `toast ${type}`;
  t.innerHTML = `<span>${msg}</span>`;
  c.appendChild(t);
  setTimeout(() => t.remove(), duration);
}

// ── Sidebar status ─────────────────────────────────────────────
function updateSidebarStatus(running) {
  const dot = document.getElementById('sidebar-status-dot');
  const txt = document.getElementById('sidebar-status-text');
  dot.classList.toggle('active', running);
  txt.textContent = running ? 'Capture active' : 'Inactif';
}
fetch('/api/capture/status').then(r=>r.json()).then(d=>updateSidebarStatus(d.running));

// ── Dark / Light mode ──────────────────────────────────────────
function applyTheme(theme) {
  document.documentElement.setAttribute('data-theme', theme);
  const track = document.getElementById('toggle-track');
  const label = document.getElementById('theme-label');
  if (theme === 'light') {
    track.classList.add('on');
    label.textContent = 'Mode clair';
  } else {
    track.classList.remove('on');
    label.textContent = 'Mode sombre';
  }
  localStorage.setItem('nw-theme', theme);
}

function toggleTheme() {
  const current = document.documentElement.getAttribute('data-theme');
  applyTheme(current === 'dark' ? 'light' : 'dark');
}

// Load saved theme
const savedTheme = localStorage.getItem('nw-theme') || 'dark';
applyTheme(savedTheme);
</script>
{% block scripts %}{% endblock %}
</body>
</html>
